name: Run Packer AMI build

on:
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Packer Build
        run: packer build -var 'aws_access_key=${{ secrets.AWS_ACCESS_KEY_ID }}' -var 'aws_secret_key=${{ secrets.AWS_SECRET_ACCESS_KEY }}' -var 'aws_region=${{ secrets.AWS_REGION }}' -var 'source_ami=ami-03d315ad33b9d49c4' -var 'subnet_id=subnet-34188552' -var 'prod_account_id=578033826244' packer-template.json

      # - name: Packer build
      #   uses: riznob/packer-build-action@v1.1
      #   with:
      #     templateFile: 'packer-template.json'
      #     varFile: 'packer-vars.json'
      #     workingDir: '.'
      #   env:
      #     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      #     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      #     AWS_DEFAULT_REGION: us-east-1
      #     AWS_SOURCE_AMI: ${{ secrets.AWS_SOURCE_AMI }}
      #     AWS_PROD_ACCOUNT_ID: ${{ secrets.AWS_PROD_ACCOUNT_ID }}